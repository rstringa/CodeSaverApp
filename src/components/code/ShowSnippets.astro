---
import Snippet from '@components/code/Snippet.astro'
import { supabase } from '@lib/supabaseClient'

const { data: userSession } = await supabase.auth.getSession()
const userSessionId = userSession?.session?.user.id
let totalSnippets = 0

let snippetsWithCategories: {
	id: any
	titulo: any
	contenido: any
	categoria_id: any
}[] = []

if (userSessionId) {
	const { data, error } = await supabase
		.from('snippets')
		.select(
			`
      id,
      titulo,
      contenido,
      categoria_id
    `
		)
		.eq('usuario_id', userSessionId)
		.order('edited_at', { ascending: false })

	if (error) {
		console.error('Error fetching snippets:', error)
	} else {
		totalSnippets = data.length
		snippetsWithCategories = data
	}
}
---

{
	totalSnippets == 0 && userSessionId ? (
		<div class="flex-col items-center justify-center rounded border border-slate-800 p-6 py-12 lg:flex">

     
          <p class="mb-2 text-2xl tracking-wide text-slate-300">
            No tienes snippets aún.
            <br />
          </p> 
		  
          <p class="text-md tracking-wide text-slate-400">
            Crea tu primer snippet haciendo click en el botón Crear Snippet.
          </p>
    

		</div>
	) : (
		<div>
			<Snippet snippetsWithCategories={snippetsWithCategories} />
		</div>
	)
}
