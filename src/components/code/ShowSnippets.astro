---
import { supabase } from "@lib/supabaseClient";
// Import highlight.js
import hljs from 'highlight.js';
let code = hljs.highlightAuto("").value;

const { data: userSession } = await supabase.auth.getSession();
const userSessionId = userSession?.session?.user.id;

// console.log(userSessionId);

let snippetsWithCategories: {
  id: any;
  titulo: any;
  contenido: any;
  categoria_id: any;
}[] = [];

if (userSessionId) {
  // const snippetAuthorData = await supabase
  //   .from("usuarios")
  //   .select("*")
  //   .eq("usuaario_id", userSessionId?.id);
  // const userId = snippetAuthorData.data && snippetAuthorData.data[0]?.id;

  const { data, error } = await supabase
    .from("snippets")
    .select(
      `
      id,
      titulo,
      contenido,
      categoria_id
    `
    )
    .eq("usuario_id", userSessionId)
    .order('created_at', { ascending: false });

  if (error) {
    console.error("Error fetching snippets:", error);
  } else {
    snippetsWithCategories = data;
  }
}

// console.log("--" + snippetsWithCategories[0]);
// console.log(snippetsWithCategories[0].snippet_categorias[0].categorias.nombre);
---

<div>
  <ul class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">
    {
      snippetsWithCategories.map((snippet) =>
        //snippet.snippet_categorias.map((categoria) => {
          //console.log(categoria.categorias);
          {
          return (
            <li
              class="_snippet flex flex-col gap-2 rounded bg-slate-600/10 p-6 text-sm transition-all transition-discrete duration-300"
              data-category_id={snippet.categoria_id}
            >
              <div data-id={snippet.id}>
                {/* <p class="inline-flex items-center gap-1 rounded-lg bg-blue-500/10 px-3 py-1 mb-2 text-sm text-blue-500">
                    {[categoria.categorias].map(cat => (
  <span>{cat.nombre}</span>
))}
                </p> */}
                <h2 class="text-xl font-semibold mb-2">{snippet.titulo}</h2>
                <div class="_snippet_content scrollbar-custom bg-slate-800 p-4 rounded flex flex-col max-h-90 overflow-y-auto 
                scroll-smooth">
                  <p class="text-[1rem]"> 
                    <pre class="hljs text-wrap break-words"><code set:html={hljs.highlightAuto(snippet.contenido).value} /></pre>
                  </p>
                </div>
              </div>
            </li>
          );
        })
      
    }
  </ul>
</div>
