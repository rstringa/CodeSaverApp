---
import { fade } from 'astro:transitions'
import { Icon } from 'astro-icon/components'
import LayoutBase from '@layouts/LayoutBase.astro'
import Sidebar from '@components/Sidebar.astro'
import Welcome from '@components/Welcome.astro'
import ShowSnippets from '@components/code/ShowSnippets.astro'
//import { userLoggedIn, userData } from '@utils/userLoggedIn'
import CreateSnippet from '@components/code/CreateSnippet.astro'

import { supabase } from '@lib/supabaseClient'

// Obtener la sesi√≥n de usuario
const { data: userSession } = await supabase.auth.getSession()
const userSessionId = userSession?.session?.user.id
---

<>
	<LayoutBase>
		<main
			class={`
				relative grid-cols-[1fr] grid
				lg:grid-cols-[270px_1fr]
				min-h-[calc(100dvh-100px)]
				${userSessionId ? 'logged-in' : 'logged-out'}
			  `}
		>
			<Sidebar />

			<div class="_content max-[100vw] h-full p-6 pb-12">
				<div class="_top mb-4 flex flex-row items-center justify-between gap-4 lg:flex-row">
					<div>
						{
							!userSessionId ? (
								<div />
							) : (
								<h1 class="_category-name text-md ml-0 flex items-center gap-2 leading-none font-semibold text-slate-300 lg:ml-6 lg:text-xl">
									<Icon name="folderCode" class="h-8 w-8 self-end lg:h-5 lg:w-5" />
									<span class="_category-text">Todos mis snippets</span>
								</h1>
							)
						}
					</div>
					<div class="mb-3 hidden lg:flex">
						<a 
							class=`_new_snippet _btn-featured font-semibold ${!userSessionId
            ? "pointer-events-none opacity-50" : "" }`
							href="#"
							>+ Crear Snippet
						</a>
					</div>
				</div>

				{!userSessionId ? 
					<Welcome />  
					:
					<ShowSnippets />
					<CreateSnippet />
				}
			</div>
		</main>
	</LayoutBase>
</>
<style>
	body.logged-out ._top {
		@media (max-width: 1024px) {
			flex-direction: column;
		}
	}
</style>
